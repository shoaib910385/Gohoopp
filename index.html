<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Specially For You</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&family=Sacramento&family=Shrikhand&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#FFF5E4',
                        pastelRed: '#FF9494',
                        deepRed: '#D83F3F',
                        coffee: '#4A3B32',
                        paper: '#FFFCF5',
                        cassette1: '#F8C8DC', /* Pinkish */
                        cassette2: '#C7EBB3', /* Greenish */
                    },
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                        script: ['Sacramento', 'cursive'],
                        retro: ['Shrikhand', 'serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                        'spin-slow': 'spin 4s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Global Styles & Reset */
        body {
            background-color: #FFF5E4;
            overflow: hidden; /* Prevent body scroll, handle inside containers */
            -webkit-tap-highlight-color: transparent;
        }

        /* Smooth Hide/Show Transitions */
        .screen {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
            opacity: 0;
            pointer-events: none;
            z-index: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto; /* Allow internal scrolling */
            overflow-x: hidden;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }

        .screen.hidden-left {
            transform: translateX(-100px);
            opacity: 0;
        }

        /* 3D Envelope Styles */
        .envelope-container {
            perspective: 1000px;
            cursor: pointer;
        }
        .envelope {
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .flap {
            transform-origin: top;
            transition: transform 0.4s 0.2s ease-in-out;
            z-index: 4;
        }
        .envelope.open .flap {
            transform: rotateX(180deg);
            z-index: 1;
        }
        .letter {
            transition: transform 0.5s 0.6s ease-out;
            z-index: 2;
        }
        .envelope.open .letter {
            transform: translateY(-100px);
            z-index: 5;
        }

        /* Cassette Styles */
        .cassette-wrapper {
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center;
        }
        /* The tilt class */
        .cassette-tilted {
            transform: rotate(-6deg) scale(0.95);
        }
        /* The playing class (straight) */
        .cassette-playing {
            transform: rotate(0deg) scale(1.05);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Flip Card */
        .flip-card {
            perspective: 1000px;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 1rem;
        }
        .flip-card-back {
            transform: rotateY(180deg);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #FF9494; border-radius: 4px; }

        /* Loader Animation for Seal */
        .heart-loader {
            width: 64px;
            height: 64px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23D83F3F'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: center;
            animation: pulse-fast 1s infinite;
        }
    </style>
</head>
<body class="text-coffee h-[100dvh] w-full relative">

    <audio id="bg-music" preload="auto"></audio>

    <div id="screen-pass" class="screen active justify-center bg-cream z-50">
        <div class="text-center p-8 w-full max-w-md">
            <h1 class="font-script text-6xl text-deepRed mb-4 animate-float">Hey Love</h1>
            <p class="text-coffee/70 mb-8 text-lg font-bold">I made something for you.</p>
            
            <div class="relative w-full">
                <input type="password" id="pass-input" placeholder="Secret Word?" 
                    class="w-full bg-white border-2 border-pastelRed rounded-full py-4 px-6 text-center text-xl outline-none focus:border-deepRed focus:ring-2 focus:ring-pastelRed/50 transition-all shadow-sm placeholder-pastelRed/50">
            </div>
            
            <button onclick="checkPass()" class="mt-8 bg-deepRed text-white px-10 py-3 rounded-full font-bold text-lg shadow-lg active:scale-95 transition-transform hover:shadow-xl hover:bg-red-700">
                Unlock ‚ù§Ô∏è
            </button>
            <p class="mt-4 text-xs text-coffee/40">Try: ummm</p>
        </div>
    </div>

    <div id="screen-loading" class="screen justify-center bg-cream z-40">
        <div class="flex flex-col items-center">
            <div class="relative w-64 h-40 mb-8">
                <img src="assets/plane.png" class="w-48 absolute top-0 left-0 animate-float" 
                     onerror="this.src='https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExNXJvZTVwZnN5Y3Z6NmN6eXJ6eXJ6eXJ6eXJ6eXJ6eXJ6eXJ6eSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/Lqx1cRk1VzJ5x4R1b4/giphy.gif'" alt="Loading">
                <div class="absolute top-10 right-0 w-12 h-6 bg-white rounded-full opacity-60 animate-pulse"></div>
                <div class="absolute bottom-0 left-10 w-16 h-8 bg-white rounded-full opacity-40 animate-pulse"></div>
            </div>
            <h2 class="font-retro text-2xl text-pastelRed tracking-wider">Loading something special...</h2>
        </div>
    </div>

    <div id="screen-landing" class="screen justify-center p-4">
        <div class="w-full max-w-sm bg-white/60 backdrop-blur-sm border-2 border-white rounded-[32px] p-6 shadow-xl text-center relative mt-10">
            <img src="assets/cat-pineapple.png" class="w-24 absolute -top-12 -right-4 rotate-12 drop-shadow-lg z-20"
                 onerror="this.src='https://media.tenor.com/b_y_8tS1V4AAAAAj/cat-cat-flower.gif'">

            <p class="font-script text-3xl text-pastelRed mt-4">welcome to my little thought...</p>
            <h1 class="font-retro text-6xl text-deepRed my-2 drop-shadow-sm">Hey You</h1>
            
            <div class="bg-[#E8F5E9] border border-[#C8E6C9] rounded-2xl p-6 my-6 relative">
                <div class="flex gap-2 mb-2 absolute top-3 left-3">
                    <div class="w-3 h-3 rounded-full bg-red-400"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-400"></div>
                    <div class="w-3 h-3 rounded-full bg-green-400"></div>
                </div>
                <p class="mt-4 text-gray-700 text-lg leading-relaxed font-semibold">
                    I wanted to do a tiny something because you mean a lot to me.
                </p>
                <p class="text-sm text-pastelRed italic mt-4">Tap below, okay? ‚ú®</p>
            </div>

            <img src="assets/cat-point.png" class="w-20 absolute -bottom-6 -left-6 -rotate-12 drop-shadow-lg z-20"
                 onerror="this.src='https://media.tenor.com/Xk_JgT5GzCAAAAAj/cat-point.gif'">

            <button onclick="nextScreen('screen-landing', 'screen-envelope')" class="w-full bg-deepRed text-white py-4 rounded-full font-bold text-xl shadow-red-200 shadow-xl hover:shadow-2xl active:scale-95 transition-all flex items-center justify-center gap-2">
                Open This üíñ
            </button>
        </div>
    </div>

    <div id="screen-envelope" class="screen justify-center p-6">
        <h1 class="font-retro text-4xl text-pastelRed mb-12 text-center leading-tight">Straight from my heart<br><span class="text-deepRed text-5xl">A Little Note</span></h1>

        <div class="envelope-container relative w-full max-w-[320px] h-[200px]" onclick="openEnvelope()">
            <div class="absolute bottom-0 w-full h-full bg-red-200 rounded-lg shadow-lg z-0"></div>
            
            <div class="letter absolute bottom-2 left-2 right-2 h-[180px] bg-white rounded p-4 shadow-sm flex items-center justify-center z-10">
                <p class="font-script text-2xl text-gray-400">Click to read...</p>
            </div>

            <div class="absolute bottom-0 w-full h-[120px] bg-red-300 rounded-b-lg z-20 overflow-hidden">
                 <div class="w-full h-full border-l-[160px] border-r-[160px] border-b-[100px] border-l-transparent border-r-transparent border-b-red-400 opacity-50 absolute bottom-0"></div>
            </div>
            
            <div id="env-flap" class="flap absolute top-0 w-full h-[100px] z-30">
                <div class="w-0 h-0 border-l-[160px] border-r-[160px] border-t-[100px] border-l-transparent border-r-transparent border-t-red-300 drop-shadow-md flex justify-center">
                    <div class="absolute -top-[60px] text-3xl">üíå</div>
                </div>
            </div>
        </div>

        <div id="read-btn" class="mt-20 opacity-0 transition-opacity duration-500 pointer-events-none">
            <button onclick="nextScreen('screen-envelope', 'screen-letter-content')" class="bg-white border-2 border-deepRed text-deepRed px-8 py-3 rounded-full font-bold shadow-sm hover:bg-red-50 transition-colors">
                Read Letter ‚û°Ô∏è
            </button>
        </div>
    </div>

    <div id="screen-letter-content" class="screen justify-center p-4">
        <div class="w-full h-[80vh] max-w-md bg-paper border border-yellow-100 rounded-xl shadow-2xl p-6 overflow-y-auto relative">
            <div class="sticky top-0 bg-paper/95 backdrop-blur pb-4 z-10 border-b border-gray-100 mb-4">
                 <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-xl">üéÅ</div>
                    <h3 class="font-bold text-xl text-deepRed font-retro">Hey My Favorite Person</h3>
                 </div>
            </div>

            <div class="prose text-gray-700 leading-8 font-medium font-sans pb-20">
                <p class="mb-4">
                    Hey Love, I may have messed up a bit. I never meant to hurt you, sometimes my brain trips over my heart.
                </p>
                <p class="mb-4">
                    What I <span class="text-deepRed font-bold">*do*</span> know for sure is how much you matter to me. You're incredibly special to me, and I hate the idea of being the reason you felt anything less than loved.
                </p>
                <p class="mb-4">
                    Thank you for being you. I hope this makes you smile, even just a little.
                </p>
                <p class="text-right font-script text-4xl text-deepRed mt-8">Always yours üíï</p>
            </div>

            <div class="fixed bottom-6 left-0 w-full flex justify-center z-20 pointer-events-none">
                <button onclick="nextScreen('screen-letter-content', 'screen-music')" class="pointer-events-auto bg-deepRed text-white px-10 py-3 rounded-full font-bold shadow-xl hover:scale-105 transition-transform">
                    Keep Going ‚ú®
                </button>
            </div>
        </div>
    </div>

    <div id="screen-music" class="screen justify-start pt-10 p-4">
        <div class="text-center mb-6">
            <p class="font-script text-3xl text-pastelRed">Hope they feel nice</p>
            <h1 class="font-retro text-4xl text-deepRed leading-tight">Some Songs That<br>Reminded Me of You</h1>
        </div>

        <div class="w-full max-w-sm mb-6 relative group">
            <div id="cassette-1" class="cassette-wrapper cassette-tilted bg-cassette1 p-3 rounded-[20px] shadow-lg border-b-4 border-black/10 relative overflow-hidden">
                <div class="h-4 bg-white/40 rounded-t-md mb-2 mx-2"></div>
                
                <div class="bg-white/90 rounded-xl p-4 flex flex-col items-center relative h-40 justify-center">
                    <h3 class="font-bold text-xl text-gray-800">For a Reason</h3>
                    <p class="text-sm text-pastelRed font-bold">I'd still choose you ü§ç</p>
                    
                    <div class="flex gap-8 mt-3 items-center justify-center w-full bg-gray-200 rounded-full h-12 relative px-4 border border-gray-300">
                        <div class="w-8 h-8 rounded-full border-4 border-white bg-gray-800 animate-spin-slow opacity-0 transition-opacity" id="gear1-left"></div>
                        <div class="w-16 h-8 bg-black/80 rounded mx-auto"></div> <div class="w-8 h-8 rounded-full border-4 border-white bg-gray-800 animate-spin-slow opacity-0 transition-opacity" id="gear1-right"></div>
                    </div>
                </div>

                <button onclick="playSong(1)" id="btn-1" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-deepRed rounded-full shadow-xl flex items-center justify-center text-white z-20 hover:scale-110 transition-transform active:scale-90">
                    <svg class="w-6 h-6 ml-1 icon-play" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg class="w-6 h-6 hidden icon-pause" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>
            </div>
        </div>

        <div class="w-full max-w-sm mb-24 relative group">
            <div id="cassette-2" class="cassette-wrapper cassette-tilted bg-cassette2 p-3 rounded-[20px] shadow-lg border-b-4 border-black/10 relative overflow-hidden">
                <div class="h-4 bg-white/40 rounded-t-md mb-2 mx-2"></div>
                <div class="bg-white/90 rounded-xl p-4 flex flex-col items-center relative h-40 justify-center">
                    <h3 class="font-bold text-xl text-gray-800">Dil Ka Jo Haal Hai</h3>
                    <p class="text-sm text-pastelRed font-bold">Because feelings happened üíï</p>
                    
                    <div class="flex gap-8 mt-3 items-center justify-center w-full bg-gray-200 rounded-full h-12 relative px-4 border border-gray-300">
                        <div class="w-8 h-8 rounded-full border-4 border-white bg-gray-800 animate-spin-slow opacity-0 transition-opacity" id="gear2-left"></div>
                        <div class="w-16 h-8 bg-black/80 rounded mx-auto"></div>
                        <div class="w-8 h-8 rounded-full border-4 border-white bg-gray-800 animate-spin-slow opacity-0 transition-opacity" id="gear2-right"></div>
                    </div>
                </div>

                <button onclick="playSong(2)" id="btn-2" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 w-14 h-14 bg-deepRed rounded-full shadow-xl flex items-center justify-center text-white z-20 hover:scale-110 transition-transform active:scale-90">
                    <svg class="w-6 h-6 ml-1 icon-play" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg class="w-6 h-6 hidden icon-pause" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                </button>
            </div>
        </div>

        <div class="fixed bottom-8 w-full flex justify-center z-30">
            <button onclick="nextScreen('screen-music', 'screen-flip')" class="bg-[#D97757] text-white px-12 py-4 rounded-full font-bold text-xl shadow-xl hover:bg-[#c06040] transition-colors">
                Next ‚ú®
            </button>
        </div>
    </div>

    <div id="screen-flip" class="screen justify-center p-6">
        <h4 class="font-script text-3xl text-pastelRed mb-2">just saying...</h4>
        <h1 class="font-retro text-4xl text-coffee mb-2 text-center">Little Things I<br>Messed Up</h1>
        <p class="text-gray-400 text-sm mb-8 animate-bounce">Tap the card to flip ‚§µÔ∏è</p>

        <div class="flip-card w-64 h-80" onclick="this.classList.toggle('flipped')">
            <div class="flip-card-inner shadow-2xl rounded-2xl">
                <div class="flip-card-front bg-[#FFF0F5] flex flex-col items-center justify-center p-6 border-4 border-white rounded-2xl">
                    <p class="font-retro text-6xl text-pastelRed mb-4">:(</p>
                    <h2 class="text-2xl font-bold text-coffee">I may have been a little dumb sometimes</h2>
                    <p class="absolute bottom-4 text-xs text-gray-400">Flip me</p>
                </div>
                <div class="flip-card-back bg-white flex flex-col items-center justify-center p-6 border-4 border-pastelRed rounded-2xl">
                    <div class="w-24 h-24 bg-red-100 rounded-full mb-4 overflow-hidden">
                        <img src="assets/cat-tomato.png" class="w-full h-full object-cover" 
                             onerror="this.src='https://media.tenor.com/QW6gA8G5HnMAAAAj/cat-tomato.gif'">
                    </div>
                    <h3 class="font-bold text-xl text-deepRed mb-2">But...</h3>
                    <p class="text-sm text-gray-600 mb-2">My intentions are always to make you happy. I'm working on it!</p>
                    <div class="mt-2 bg-yellow-100 px-3 py-1 rounded-full text-xs font-bold text-yellow-700">Observation: You cute when mad.</div>
                </div>
            </div>
        </div>

        <button onclick="nextScreen('screen-flip', 'screen-final')" class="mt-12 bg-deepRed text-white px-8 py-3 rounded-full font-bold shadow-lg hover:scale-105 transition-transform">
            One Last Thing ‚û°Ô∏è
        </button>
    </div>

    <div id="screen-final" class="screen justify-center p-6 bg-cream">
        <div class="w-full max-w-sm text-center">
            <h4 class="font-script text-4xl text-pastelRed mb-2">the grand finale...</h4>
            <h1 class="font-retro text-5xl text-deepRed mb-8">One Last Thing</h1>
            
            <div class="bg-white p-8 rounded-[30px] shadow-xl border border-red-100 w-full mb-8 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-300 via-pink-300 to-red-300"></div>
                
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl shadow-sm">
                    üíù
                </div>
                
                <h3 class="font-bold text-2xl text-coffee mb-2">Sent With Love</h3>
                <p class="font-bold text-pastelRed mb-4 tracking-widest text-xs uppercase">You Matter To Me</p>
                
                <div class="flex justify-center gap-3 text-red-500 my-4">
                    <span>‚ù§Ô∏è</span><span>‚ù§Ô∏è</span><span>‚ù§Ô∏è</span><span>‚ù§Ô∏è</span><span>‚ù§Ô∏è</span>
                </div>
            </div>

            <button onclick="sealIt()" class="bg-green-500 text-white w-full py-4 rounded-full font-bold text-xl shadow-green-200 shadow-xl transition-all active:scale-95 hover:bg-green-600 flex items-center justify-center gap-2">
                Seal It üíå
            </button>
            
            <button onclick="location.reload()" class="mt-8 text-coffee/40 text-sm font-bold underline decoration-wavy">
                Restart
            </button>
        </div>
    </div>

    <div id="overlay-seal" class="fixed inset-0 z-[100] hidden flex-col items-center justify-center bg-black/30 backdrop-blur-md transition-opacity duration-500 opacity-0">
        <div class="bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center animate-pop">
            <div class="heart-loader mb-4"></div>
            <h2 class="font-retro text-2xl text-deepRed">Sealing with love...</h2>
        </div>
    </div>

    <script>
        // === CONFIGURATION ===
        // Replace these URLs with your actual MP3/OGG file URLs
        const songs = {
            1: "https://files.catbox.moe/4giqf5.ogg", // Replace with Song 1 URL
            2: "https://files.catbox.moe/uhkx81.ogg"  // Replace with Song 2 URL
        };

        const audio = document.getElementById('bg-music');
        let currentCassetteId = null;

        // === NAVIGATION ===
        function nextScreen(fromId, toId) {
            const fromEl = document.getElementById(fromId);
            const toEl = document.getElementById(toId);
            
            // Slide out
            fromEl.classList.add('hidden-left');
            fromEl.classList.remove('active');
            
            // Delay to allow slide out animation
            setTimeout(() => {
                fromEl.style.display = 'none'; // fully remove layout
                
                toEl.style.display = 'flex'; // prepare layout
                // Force reflow
                void toEl.offsetWidth; 
                
                toEl.classList.add('active');
            }, 500);
        }

        // === PASSWORD LOGIC ===
        function checkPass() {
            const val = document.getElementById('pass-input').value.toLowerCase().trim();
            if(val === "ummm") { // The secret word
                nextScreen('screen-pass', 'screen-loading');
                // Fake loading time
                setTimeout(() => {
                    nextScreen('screen-loading', 'screen-landing');
                }, 3500);
            } else {
                const input = document.getElementById('pass-input');
                input.classList.add('border-red-500', 'animate-wiggle');
                setTimeout(() => input.classList.remove('border-red-500', 'animate-wiggle'), 500);
            }
        }

        // === ENVELOPE LOGIC ===
        function openEnvelope() {
            const container = document.querySelector('.envelope-container .envelope');
            if(!container.classList.contains('open')) {
                container.classList.add('open'); // Triggers CSS transform
                // Show button after animation
                setTimeout(() => {
                    document.getElementById('read-btn').style.opacity = '1';
                    document.getElementById('read-btn').style.pointerEvents = 'auto';
                }, 800);
            }
        }

        // === MUSIC LOGIC (CRITICAL: Instant Play & Tilt) ===
        function playSong(id) {
            // 1. Reset Visuals of previous cassette
            if (currentCassetteId && currentCassetteId !== id) {
                resetCassetteVisuals(currentCassetteId);
            }

            const wrapper = document.getElementById(`cassette-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            
            // 2. Toggle Play/Pause Logic
            if (currentCassetteId === id && !audio.paused) {
                // If clicking same active song -> PAUSE
                audio.pause();
                resetCassetteVisuals(id);
                return; // Stop here
            }

            // 3. Play New Song
            // Set source
            audio.src = songs[id];
            // Play instantly
            audio.play().then(() => {
                // 4. Update Visuals ONLY after play confirms
                wrapper.classList.remove('cassette-tilted');
                wrapper.classList.add('cassette-playing');
                
                // Show Pause Icon
                btn.querySelector('.icon-play').classList.add('hidden');
                btn.querySelector('.icon-pause').classList.remove('hidden');

                // Spin gears
                document.getElementById(`gear${id}-left`).style.opacity = '1';
                document.getElementById(`gear${id}-right`).style.opacity = '1';
                
                currentCassetteId = id;
            }).catch(e => {
                console.log("Browser blocked autoplay or URL invalid", e);
            });
        }

        function resetCassetteVisuals(id) {
            const wrapper = document.getElementById(`cassette-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            
            // Add tilt back
            wrapper.classList.add('cassette-tilted');
            wrapper.classList.remove('cassette-playing');
            
            // Show Play Icon
            btn.querySelector('.icon-play').classList.remove('hidden');
            btn.querySelector('.icon-pause').classList.add('hidden');
            
            // Stop gears
            document.getElementById(`gear${id}-left`).style.opacity = '0';
            document.getElementById(`gear${id}-right`).style.opacity = '0';
        }

        // Ensure music loops or resets (Optional)
        audio.onended = () => {
            if(currentCassetteId) resetCassetteVisuals(currentCassetteId);
        };

        // === FINAL SEAL LOGIC ===
        function sealIt() {
            const overlay = document.getElementById('overlay-seal');
            
            // Show overlay
            overlay.classList.remove('hidden');
            overlay.style.display = 'flex';
            // Trigger Fade In
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
            }, 50);

            // Wait 2.5 seconds, then Celebration
            setTimeout(() => {
                // Change overlay text
                overlay.innerHTML = `
                    <div class="bg-white p-8 rounded-3xl shadow-2xl flex flex-col items-center animate-pop text-center">
                        <div class="text-6xl mb-4">‚ú®</div>
                        <h2 class="font-retro text-4xl text-deepRed mb-2">Sent!</h2>
                        <p class="text-gray-500">I love you.</p>
                    </div>
                `;
                
                fireConfetti();
            }, 2500);
        }

        function fireConfetti() {
            var duration = 3 * 1000;
            var end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    colors: ['#FF9494', '#D83F3F', '#FFF5E4']
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    colors: ['#FF9494', '#D83F3F', '#FFF5E4']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        }
    </script>
</body>
</html>
